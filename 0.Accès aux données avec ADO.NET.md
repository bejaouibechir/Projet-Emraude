# Accès aux données avec ADO.NET

### Différence entre le Mode Connecté et le Mode Déconnecté

#### 1. **Mode Connecté**
- **Cas d'utilisation** : Utilisé lorsque vous avez besoin d'un accès continu à la base de données pour lire ou manipuler des données en temps réel.
- **Classes principales** : `SqlConnection`, `SqlCommand`, `SqlDataReader`.
- **Exemple** : Lecture de données en mode connecté avec `SqlDataReader`.

```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    conn.Open();
    SqlCommand cmd = new SqlCommand("SELECT * FROM Products", conn);
    SqlDataReader reader = cmd.ExecuteReader();

    while (reader.Read())
    {
        Console.WriteLine(reader["ProductName"]);
    }
}
```

#### 2. **Mode Déconnecté**
- **Cas d'utilisation** : Utilisé lorsque vous souhaitez manipuler des données sans maintenir une connexion continue avec la base de données. Idéal pour le traitement des données en mémoire.
- **Classes principales** : `DataSet`, `DataTable`, `SqlDataAdapter`.
- **Exemple** : Remplissage d'un `DataSet` en mode déconnecté.

```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    SqlDataAdapter adapter = new SqlDataAdapter("SELECT * FROM Products", conn);
    DataSet dataSet = new DataSet();
    adapter.Fill(dataSet, "Products");

    foreach (DataRow row in dataSet.Tables["Products"].Rows)
    {
        Console.WriteLine(row["ProductName"]);
    }
}
```

### Accès aux données avec ADO.NET

#### 1. **Connexion à la Base de Données**
- **Explication** : Établir une connexion à la base de données avec `SqlConnection`.
- **Exemple** :
```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    conn.Open();
    // Utilisez la connexion ici
}
```

#### 2. **Commandes SQL**
- **Explication** : Exécuter des requêtes SQL en utilisant `SqlCommand`.
- **Exemple** : Insertion d'un nouveau produit.
```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    conn.Open();
    SqlCommand cmd = new SqlCommand("INSERT INTO Products (ProductName) VALUES (@name)", conn);
    cmd.Parameters.AddWithValue("@name", "New Product");
    cmd.ExecuteNonQuery();
}
```

#### 3. **Lecture des Données**
- **Explication** : Utilisation de `SqlDataReader` pour lire des données en mode connecté.
- **Exemple** : Lire et afficher les produits.
```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    conn.Open();
    SqlCommand cmd = new SqlCommand("SELECT * FROM Products", conn);
    SqlDataReader reader = cmd.ExecuteReader();

    while (reader.Read())
    {
        Console.WriteLine(reader["ProductName"]);
    }
}
```

#### 4. **Manipulation des Données**
- **Explication** : Manipuler des données en mémoire avec `DataSet` et `DataTable`.
- **Exemple** : Remplir un `DataSet` et l'afficher.
```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    SqlDataAdapter adapter = new SqlDataAdapter("SELECT * FROM Products", conn);
    DataSet dataSet = new DataSet();
    adapter.Fill(dataSet, "Products");

    foreach (DataRow row in dataSet.Tables["Products"].Rows)
    {
        Console.WriteLine(row["ProductName"]);
    }
}
```

#### 5. **Transactions**
- **Explication** : Gestion des transactions pour garantir l'intégrité des données.
- **Exemple** : Exécution d'une transaction.
```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    conn.Open();
    SqlTransaction transaction = conn.BeginTransaction();

    try
    {
        SqlCommand cmd1 = new SqlCommand("INSERT INTO Products (ProductName) VALUES ('Product1')", conn, transaction);
        cmd1.ExecuteNonQuery();

        SqlCommand cmd2 = new SqlCommand("INSERT INTO Products (ProductName) VALUES ('Product2')", conn, transaction);
        cmd2.ExecuteNonQuery();

        transaction.Commit();
    }
    catch
    {
        transaction.Rollback();
    }
}
```

#### 6. **Gestion des Erreurs**
- **Explication** : Utilisation de `try-catch` pour gérer les exceptions.
- **Exemple** : Gestion d'erreurs lors de l'exécution d'une commande SQL.
```csharp
try
{
    using (SqlConnection conn = new SqlConnection("YourConnectionString"))
    {
        conn.Open();
        SqlCommand cmd = new SqlCommand("DELETE FROM Products WHERE ProductID = @id", conn);
        cmd.Parameters.AddWithValue("@id", 1);
        cmd.ExecuteNonQuery();
    }
}
catch (SqlException ex)
{
    Console.WriteLine("Erreur SQL : " + ex.Message);
}
```

#### 7. **Performance et Optimisation**
- **Explication** : Utilisation de paramètres SQL pour éviter les injections SQL et optimiser les performances.
- **Exemple** : Exemple de requête paramétrée pour éviter les injections SQL.
```csharp
using (SqlConnection conn = new SqlConnection("YourConnectionString"))
{
    conn.Open();
    SqlCommand cmd = new SqlCommand("SELECT * FROM Products WHERE ProductName = @name", conn);
    cmd.Parameters.AddWithValue("@name", "Product1");
    SqlDataReader reader = cmd.ExecuteReader();

    while (reader.Read())
    {
        Console.WriteLine(reader["ProductName"]);
    }
}
```

#### 8. **Déconnexion et Gestion des Ressources**
- **Explication** : Fermeture de la connexion et libération des ressources.
- **Exemple** : Fermeture explicite de la connexion.
```csharp
SqlConnection conn = null;
try
{
    conn = new SqlConnection("YourConnectionString");
    conn.Open();
    // Utilisation de la connexion
}
finally
{
    if (conn != null && conn.State == ConnectionState.Open)
        conn.Close();
}
```

Ces exemples couvrent les aspects fondamentaux de l'accès aux données avec ADO.NET en utilisant à la fois les modes connecté et déconnecté, ainsi que les pratiques recommandées pour gérer les transactions, les erreurs, et optimiser les performances.
